<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Study & Work OS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f0f2f5; }
    .section { background: white; border-radius: .75rem; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 1px 5px rgba(0,0,0,0.1);}
    .section-header { font-size: 1.4rem; font-weight: bold; margin-bottom: 1rem;}
  </style>
</head>
<body class="p-4">
<div class="container">
  <h1 class="text-center mb-4">🎯 Study & Work OS</h1>

  <!-- Dashboard -->
  <div class="section" id="dashboard">
    <div class="section-header">📊 Dashboard</div>
    <div id="overviewStats"></div>
  </div>

  <!-- Corsi e scadenze -->
  <div class="section" id="courses">
    <div class="section-header">📚 Corsi & Scadenze</div>
    <table class="table table-striped">
      <thead><tr><th>Corso</th><th>Scadenze</th><th>Azione</th></tr></thead>
      <tbody id="courseTable"></tbody>
    </table>
    <div class="input-group">
      <input type="text" id="courseName" class="form-control" placeholder="Nuovo corso">
      <input type="date" id="courseDeadline" class="form-control">
      <button class="btn btn-primary" onclick="addCourse()">Aggiungi</button>
    </div>
  </div>

  <!-- To‑Do per progetto -->
  <div class="section" id="todos">
    <div class="section-header">✅ Progetti e Task</div>
    <ul id="todoList" class="list-group mb-3"></ul>
    <div class="input-group">
      <input type="text" id="todoText" class="form-control" placeholder="Nuovo task">
      <select id="todoCourse" class="form-select">
        <option value="">Tutti</option>
      </select>
      <button class="btn btn-success" onclick="addTodo()">Aggiungi</button>
    </div>
  </div>

  <!-- Sezione note -->
  <div class="section" id="notes">
    <div class="section-header">📝 Appunti</div>
    <textarea id="notesArea" class="form-control" rows="6" placeholder="Scrivi i tuoi appunti..."></textarea>
    <button class="btn btn-outline-secondary mt-2" onclick="saveNotes()">Salva Note</button>
  </div>

  <!-- Calendario -->
  <div class="section" id="calendarSection">
    <div class="section-header">📅 Mini‑Calendario</div>
    <input type="date" id="calendarInput" class="form-control mb-2" onchange="showTodayEvents()">
    <ul id="eventsList" class="list-group"></ul>
  </div>

</div>

<script>
  // Storage
  const storage = window.localStorage;

  // Dashboard funzioni
  function refreshDashboard(){
    const courses = JSON.parse(storage.getItem('courses')||'[]');
    const todos = JSON.parse(storage.getItem('todos')||'[]');
    document.getElementById('overviewStats').innerHTML = 
      `<p>Hai <strong>${courses.length}</strong> corsi e <strong>${todos.filter(t=>!t.done).length}</strong> task in sospeso.</p>`;
  }

  // Courses
  function renderCourses(){
    const arr = JSON.parse(storage.getItem('courses')||'[]');
    const tb = document.getElementById('courseTable'); tb.innerHTML = '';
    const sel = document.getElementById('todoCourse'); sel.innerHTML = '<option value="">Tutti</option>';
    arr.forEach((c,i)=> {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${c.name}</td><td>${c.deadline||'-'}</td>
        <td><button class="btn btn-sm btn-danger" onclick="deleteCourse(${i})">✕</button></td>`;
      tb.appendChild(tr);
      const opt = document.createElement('option');
      opt.value = c.name; opt.text = c.name; sel.appendChild(opt);
    });
    refreshDashboard();
  }
  function addCourse(){
    const name = document.getElementById('courseName').value.trim();
    const dl = document.getElementById('courseDeadline').value;
    if(name){
      const arr = JSON.parse(storage.getItem('courses')||'[]');
      arr.push({name, deadline: dl});
      storage.setItem('courses', JSON.stringify(arr));
      renderCourses();
      document.getElementById('courseName').value = '';
      document.getElementById('courseDeadline').value = '';
    }
  }
  function deleteCourse(i){
    const arr = JSON.parse(storage.getItem('courses')||'[]');
    arr.splice(i,1);
    storage.setItem('courses', JSON.stringify(arr));
    renderCourses();
  }

  // To‑Do
  function renderTodos(){
    const list = JSON.parse(storage.getItem('todos')||'[]');
    const ul = document.getElementById('todoList'); ul.innerHTML = '';
    list.forEach((t,i)=>{
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `<div><input type="checkbox" ${t.done?'checked':''} onchange="toggleTodo(${i})"> <span ${t.done?'style="text-decoration:line-through"':''}>${t.text} ${t.course?`(${t.course})`:''}</span></div>
        <button class="btn btn-sm btn-danger" onclick="removeTodo(${i})">✕</button>`;
      ul.appendChild(li);
    });
    refreshDashboard();
  }
  function addTodo(){
    const txt = document.getElementById('todoText').value.trim();
    const course = document.getElementById('todoCourse').value;
    if(txt){
      const arr = JSON.parse(storage.getItem('todos')||'[]');
      arr.push({text: txt, course, done:false});
      storage.setItem('todos', JSON.stringify(arr));
      document.getElementById('todoText').value = '';
      renderTodos();
    }
  }
  function toggleTodo(i){
    const arr = JSON.parse(storage.getItem('todos')||'[]');
    arr[i].done = !arr[i].done;
    storage.setItem('todos', JSON.stringify(arr));
    renderTodos();
  }
  function removeTodo(i){
    const arr = JSON.parse(storage.getItem('todos')||'[]');
    arr.splice(i,1);
    storage.setItem('todos', JSON.stringify(arr));
    renderTodos();
  }

  // Note
  function saveNotes(){
    storage.setItem('notes', document.getElementById('notesArea').value);
    alert('Note salvate!');
  }

  // Calendar events = solo demo: scadenze corsi usate come eventi
  function showTodayEvents(){
    const date = document.getElementById('calendarInput').value;
    const courses = JSON.parse(storage.getItem('courses')||'[]');
    const ul = document.getElementById('eventsList'); ul.innerHTML = '';
    courses.filter(c=>c.deadline===date).forEach(c=>{
      const li = document.createElement('li');
      li.className='list-group-item';
      li.textContent = `Scadenza: ${c.name}`;
      ul.appendChild(li);
    });
  }

  // Init
  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('notesArea').value = storage.getItem('notes')||'';
    renderCourses();
    renderTodos();
  });
</script>
</body>
</html>
